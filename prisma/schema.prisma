// ============================================
// COMPLETE SIMPLIFIED SCHOOL MANAGEMENT SYSTEM
// Optimized for Kenya CBC Curriculum
// ============================================

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum SchoolType {
  PUBLIC
  PRIVATE
  MISSION
  OTHER
}

enum EducationLevel {
  PRE_PRIMARY
  PRIMARY
  JUNIOR_SECONDARY
  SENIOR_SECONDARY
  MIXED
}

enum UserRole {
  ADMIN
  TEACHER
  PARENT
  STUDENT
  STAFF
}

enum SubjectCategory {
  LANGUAGES
  MATHEMATICS
  SCIENCES
  SOCIAL_STUDIES
  CREATIVE_ARTS
  TECHNICAL_STUDIES
  PHYSICAL_EDUCATION
  LIFE_SKILLS
}

enum AssessmentType {
  FORMATIVE
  SUMMATIVE
  PROJECT
  PRACTICAL
  ORAL
  QUIZ
}

enum GradeSymbol {
  EXCEEDING
  MEETING
  APPROACHING
  BELOW
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum IncidentSeverity {
  MINOR
  MODERATE
  SERIOUS
  CRITICAL
}

enum NotificationChannel {
  EMAIL
  SMS
  IN_APP
  PUSH
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
  READ
}

enum AdminAccessLevel {
  SUPER_ADMIN
  SCHOOL_ADMIN
  MANAGEMENT
  SECURITY_HIGH
  SECURITY_LOW
}

enum FileCategory {
  PROFILE_PICTURE
  ASSIGNMENT_SUBMISSION
  LEARNING_RESOURCE
  REPORT_DOCUMENT
  ADMISSION_DOCUMENT
  FEE_STRUCTURE
  FEE_RECEIPT
  OTHER
}

enum LogType {
  SECURITY
  NOTIFICATION
  CREATE
  DELETE
  UPDATE
  READ
  ACTIVITY
}

enum LogLevel {
  LOW
  HIGH
  NORMAL
  ABSTRACT
  EMERGENCY
}

enum PaymentMethod {
  MPESA
  BANK_TRANSFER
  CASH
  CARD
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum FeeType {
  TUITION
  TRANSPORT
  LUNCH
  UNIFORM
  BOOKS
  EXAM
  OTHER
}

enum TimetableDay {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum GradeLevel {
  GRADE_1
  GRADE_2
  GRADE_3
  GRADE_4
  GRADE_5
  GRADE_6
  GRADE_7
  GRADE_8
  GRADE_9
  GRADE_10
  GRADE_11
  GRADE_12
}

enum ClassLevel {
  PRE_PRIMARY
}

// ============================================
// SCHOOL MODEL
// ============================================

model School {
  id String @id @default(uuid()) @db.Uuid

  // Basic Information
  schoolName     String
  schoolCode     String?        @unique
  nationalCode   String?        @unique
  schoolType     SchoolType     @default(PUBLIC)
  educationLevel EducationLevel

  // Contact Information
  emailAddress    String?
  phoneNumber     String?
  physicalAddress String?
  websiteUrl      String?

  // Location (Kenya-specific)
  countyName    String?
  subCountyName String?
  wardName      String?
  gpsLatitude   Float?
  gpsLongitude  Float?

  // Settings
  timezoneName           String @default("Africa/Nairobi")
  maximumStudentCapacity Int?
  currentStudentCount    Int?   @default(0)

  // School Branding
  logoUrl      String?
  primaryColor String? @default("#1976d2")

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)

  // Relations
  users         User[]
  academicYears AcademicYear[]
  classes       Class[]
  subjects      Subject[]
  announcements Announcement[]
  fees          Fee[]
  payments      Payment[]
  settings      SchoolSetting[]

  @@index([schoolCode])
  @@index([nationalCode])
  @@index([countyName])
  @@index([isActive])
}

// ============================================
// USER MANAGEMENT
// ============================================

model User {
  id String @id @default(uuid()) @db.Uuid

  // Authentication
  username       String @unique
  emailAddress   String @unique
  hashedPassword String

  // Personal Information
  firstName              String
  lastName               String
  middleName             String?
  phoneNumber            String?
  alternativePhoneNumber String?
  dateOfBirth            DateTime?
  gender                 String?
  nationalIdNumber       String?   @unique

  // System Fields
  currentRole       UserRole
  preferredLanguage String   @default("en")
  profilePictureUrl String?

  // Status
  isActive        Boolean   @default(true)
  isEmailVerified Boolean   @default(false)
  isPhoneVerified Boolean   @default(false)
  lastLoginAt     DateTime?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // School Association
  schoolId String? @db.Uuid
  school   School? @relation(fields: [schoolId], references: [id])

  // Profile Relations
  teacherProfile Teacher?
  studentProfile Student?
  parentProfile  Parent?
  adminProfile   Admin?

  // Activity Relations
  sentNotifications     Notification[] @relation("NotificationSender")
  receivedNotifications Notification[] @relation("NotificationRecipient")
  createdAnnouncements  Announcement[] @relation("AnnouncementCreator")
  auditLogs             AuditLog[]     @relation("AuditLogActor")

  @@index([schoolId])
  @@index([emailAddress])
  @@index([currentRole])
  @@index([isActive])
}

// ============================================
// USER PROFILES
// ============================================

model Admin {
  id          String           @id @default(uuid()) @db.Uuid
  userId      String           @unique @db.Uuid
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessLevel AdminAccessLevel

  //   timestamops
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Teacher {
  id String @id @default(uuid()) @db.Uuid

  userId String @unique @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Teacher Information
  nationalTeacherId String?   @unique
  tscNumber         String?   @unique
  employmentNumber  String?
  employmentDate    DateTime?

  // Qualifications
  highestQualification String?
  specializations      String[]
  yearsOfExperience    Int?

  // Role
  isHeadOfDepartment Boolean @default(false)
  departmentName     String?

  // Relations
  classSubjects    ClassSubject[]
  classesAsTeacher Class[]         @relation("ClassTeacher")
  timetableSlots   TimetableSlot[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([nationalTeacherId])
  @@index([tscNumber])
}

model Student {
  id String @id @default(uuid()) @db.Uuid

  userId String @unique @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Student Identification
  nationalStudentId String?   @unique
  admissionNumber   String?   @unique
  dateOfAdmission   DateTime?

  // Current Class
  currentClassId String? @db.Uuid
  currentClass   Class?  @relation(fields: [currentClassId], references: [id], onDelete: SetNull)

  // class records

  classHistory StudentClassHistory[] @relation("StudentClassHistory")

  // Health & Special Needs
  hasSpecialNeeds     Boolean @default(false)
  specialNeedsDetails String?
  medicalConditions   String?
  allergies           String?
  bloodGroup          String?

  // Emergency Contact
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?

  // Relations
  parentStudents        ParentStudent[]
  scores                StudentScore[]
  assignmentSubmissions AssignmentSubmission[]
  attendanceRecords     Attendance[]
  behaviorIncidents     BehaviorIncident[]
  feePayments           Payment[]
  reportCards           ReportCard[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([nationalStudentId])
  @@index([admissionNumber])
  @@index([currentClassId])
}

model StudentClassHistory {
  id        String   @id @default(uuid()) @db.Uuid
  studentId String   @db.Uuid
  classId   String   @db.Uuid
  class     Class    @relation(fields: [classId], references: [id])
  student   Student  @relation("StudentClassHistory", fields: [studentId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Parent {
  id String @id @default(uuid()) @db.Uuid

  userId String @unique @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Parent Information
  occupation         String?
  employerName       String?
  workPhoneNumber    String?
  workEmailAddress   String?
  residentialAddress String?

  // Emergency Contact
  isEmergencyContact Boolean @default(true)

  // Relations
  children ParentStudent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ParentStudent {
  id String @id @default(uuid()) @db.Uuid

  parentId String @db.Uuid
  parent   Parent @relation(fields: [parentId], references: [id], onDelete: Cascade)

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  relationshipType String
  isPrimaryContact Boolean @default(false)
  canPickup        Boolean @default(true)

  createdAt DateTime @default(now())

  @@unique([parentId, studentId])
  @@index([parentId])
  @@index([studentId])
}

// ============================================
// ACADEMIC STRUCTURE
// ============================================

model AcademicYear {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  yearName      String
  startDate     DateTime
  endDate       DateTime
  isCurrentYear Boolean  @default(false)

  terms       Term[]
  classes     Class[]
  reportCards ReportCard[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schoolId, yearName])
  @@index([schoolId, isCurrentYear])
}

model Term {
  id String @id @default(uuid()) @db.Uuid

  academicYearId String       @db.Uuid
  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: Cascade)

  termNumber    Int
  termName      String
  startDate     DateTime
  endDate       DateTime
  isCurrentTerm Boolean  @default(false)

  assessments Assessment[]
  reportCards ReportCard[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([academicYearId, termNumber])
  @@index([academicYearId, isCurrentTerm])
}

model Class {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  academicYearId String       @db.Uuid
  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: Cascade)

  // Class Information
  className  String
  gradeLevel Int
  streamName String?

  // Capacity
  maximumCapacity     Int?
  currentStudentCount Int? @default(0)

  // Location & Teacher
  classroomLocation String?
  classTeacherId    String?  @db.Uuid
  classTeacher      Teacher? @relation("ClassTeacher", fields: [classTeacherId], references: [id], onDelete: SetNull)

  // Relations
  students          Student[]
  classSubjects     ClassSubject[]
  attendanceRecords Attendance[]
  timetableSlots    TimetableSlot[]
  ClassHistory      StudentClassHistory[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schoolId, academicYearId, className])
  @@index([schoolId, academicYearId])
  @@index([classTeacherId])
}

// ============================================
// CURRICULUM & SUBJECTS
// ============================================

model Subject {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  // Subject Information
  subjectName     String
  subjectCode     String
  subjectCategory SubjectCategory
  description     String?

  // Curriculum Alignment
  isCoreSubject Boolean @default(false)
  isOptional    Boolean @default(false)
  gradeLevels   Int[]

  // Relations
  classSubjects    ClassSubject[]
  learningOutcomes LearningOutcome[]
  resources        LearningResource[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schoolId, subjectCode])
  @@index([schoolId])
  @@index([subjectCategory])
}

model ClassSubject {
  id String @id @default(uuid()) @db.Uuid

  classId String @db.Uuid
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)

  subjectId String  @db.Uuid
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  assignedTeacherId String?  @db.Uuid
  assignedTeacher   Teacher? @relation(fields: [assignedTeacherId], references: [id], onDelete: SetNull)

  periodsPerWeek Int?

  assignments    Assignment[]
  assessments    Assessment[]
  timetableSlots TimetableSlot[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([classId, subjectId])
  @@index([classId])
  @@index([subjectId])
  @@index([assignedTeacherId])
}

model LearningOutcome {
  id String @id @default(uuid()) @db.Uuid

  subjectId String  @db.Uuid
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  outcomeCode      String?
  outcomeStatement String
  gradeLevel       Int

  strandName String?
  topicName  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([subjectId, gradeLevel])
}

// ============================================
// ASSESSMENTS & GRADING
// ============================================

model Assessment {
  id String @id @default(uuid()) @db.Uuid

  assessmentTitle String
  assessmentType  AssessmentType
  description     String?

  classSubjectId String       @db.Uuid
  classSubject   ClassSubject @relation(fields: [classSubjectId], references: [id], onDelete: Cascade)

  termId String? @db.Uuid
  term   Term?   @relation(fields: [termId], references: [id], onDelete: SetNull)

  maximumScore     Float
  passingScore     Float?
  weightPercentage Float? @default(100)

  assessmentDate DateTime?
  dueDate        DateTime?

  studentScores StudentScore[]

  createdBy String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([classSubjectId])
  @@index([termId])
  @@index([assessmentDate])
}

model StudentScore {
  id String @id @default(uuid()) @db.Uuid

  assessmentId String     @db.Uuid
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  scoreEarned    Float?
  gradeSymbol    GradeSymbol?
  teacherComment String?

  submittedAt DateTime?
  gradedAt    DateTime?
  gradedBy    String?   @db.Uuid

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([assessmentId, studentId])
  @@index([assessmentId])
  @@index([studentId])
}

// ============================================
// ASSIGNMENTS
// ============================================

model Assignment {
  id String @id @default(uuid()) @db.Uuid

  assignmentTitle String
  instructions    String

  classSubjectId String       @db.Uuid
  classSubject   ClassSubject @relation(fields: [classSubjectId], references: [id], onDelete: Cascade)

  assignedDate DateTime @default(now())
  dueDate      DateTime

  maximumScore        Float?
  allowLateSubmission Boolean @default(false)

  submissions AssignmentSubmission[]

  createdBy String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([classSubjectId])
  @@index([dueDate])
}

model AssignmentSubmission {
  id String @id @default(uuid()) @db.Uuid

  assignmentId String     @db.Uuid
  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  submissionText String?
  attachmentUrls String[]

  submittedAt      DateTime?
  isLateSubmission Boolean   @default(false)

  scoreEarned     Float?
  teacherFeedback String?
  gradedAt        DateTime?
  gradedBy        String?   @db.Uuid

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([assignmentId, studentId])
  @@index([assignmentId])
  @@index([studentId])
}

// ============================================
// ATTENDANCE
// ============================================

model Attendance {
  id String @id @default(uuid()) @db.Uuid

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  classId String @db.Uuid
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)

  attendanceDate   DateTime         @db.Date
  attendanceStatus AttendanceStatus
  notes            String?

  markedBy String   @db.Uuid
  markedAt DateTime @default(now())

  @@unique([studentId, classId, attendanceDate])
  @@index([studentId])
  @@index([classId, attendanceDate])
}

// ============================================
// BEHAVIOR & DISCIPLINE
// ============================================

model BehaviorIncident {
  id String @id @default(uuid()) @db.Uuid

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  incidentDate  DateTime
  incidentType  String
  severityLevel IncidentSeverity
  description   String
  location      String?

  actionTaken     String?
  isResolved      Boolean   @default(false)
  resolutionNotes String?
  resolvedAt      DateTime?

  reportedBy String   @db.Uuid
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([studentId])
  @@index([incidentDate])
}

// ============================================
// TIMETABLE
// ============================================
model TimetableSlot {
  id String @id @default(uuid()) @db.Uuid

  classId String @db.Uuid
  class   Class  @relation(fields: [classId], references: [id], onDelete: Cascade)

  classSubjectId String?       @db.Uuid
  classSubject   ClassSubject? @relation(fields: [classSubjectId], references: [id], onDelete: SetNull)

  teacherId String?  @db.Uuid
  teacher   Teacher? @relation(fields: [teacherId], references: [id], onDelete: SetNull)

  dayOfWeek    TimetableDay
  startTime    String
  endTime      String
  roomLocation String?

  isBreak   Boolean @default(false)
  breakName String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([classId, dayOfWeek, startTime])
  @@index([classId])
  @@index([teacherId])
}

// ============================================
// REPORT CARDS
// ============================================

model ReportCard {
  id String @id @default(uuid()) @db.Uuid

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  academicYearId String       @db.Uuid
  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: Cascade)

  termId String @db.Uuid
  term   Term   @relation(fields: [termId], references: [id], onDelete: Cascade)

  overallGrade         String?
  classPosition        Int?
  totalStudentsInClass Int?

  teacherComment   String?
  principalComment String?

  attendanceDaysPresent Int?
  attendanceDaysAbsent  Int?

  isPublished Boolean   @default(false)
  publishedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([studentId, academicYearId, termId])
  @@index([studentId])
  @@index([academicYearId, termId])
}

// ============================================
// FEES & PAYMENTS
// ============================================

model Fee {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  feeName     String
  feeType     FeeType
  amount      Float
  description String?

  gradeLevels Int[]
  isOptional  Boolean   @default(false)
  dueDate     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([schoolId])
  @@index([feeType])
}

model Payment {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  studentId String  @db.Uuid
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  amount        Float
  paymentMethod PaymentMethod
  paymentStatus PaymentStatus @default(PENDING)

  feeType     FeeType?
  description String?

  transactionReference String?
  paymentDate          DateTime @default(now())

  receiptNumber String? @unique
  receiptUrl    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([schoolId])
  @@index([studentId])
  @@index([paymentStatus])
  @@index([paymentDate])
}

// ============================================
// LEARNING RESOURCES
// ============================================

model LearningResource {
  id String @id @default(uuid()) @db.Uuid

  subjectId String?  @db.Uuid
  subject   Subject? @relation(fields: [subjectId], references: [id], onDelete: SetNull)

  resourceTitle String
  description   String?
  resourceUrl   String
  fileType      String?
  fileSize      Int?

  gradeLevels Int[]
  tags        String[]

  isPublic Boolean @default(false)

  uploadedBy String   @db.Uuid
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([subjectId])
}

// ============================================
// FILE UPLOADS
// ============================================

model FileUpload {
  id String @id @default(uuid()) @db.Uuid

  fileName         String
  originalFileName String
  fileUrl          String
  mimeType         String?
  fileSize         Int?
  fileCategory     FileCategory

  uploadedBy        String  @db.Uuid
  relatedEntityType String?
  relatedEntityId   String?

  createdAt DateTime @default(now())

  @@index([uploadedBy])
  @@index([relatedEntityType, relatedEntityId])
}

// ============================================
// NOTIFICATIONS
// ============================================

model Notification {
  id String @id @default(uuid()) @db.Uuid

  senderId String? @db.Uuid
  sender   User?   @relation("NotificationSender", fields: [senderId], references: [id], onDelete: SetNull)

  recipientId String @db.Uuid
  recipient   User   @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: Cascade)

  notificationChannel NotificationChannel
  notificationStatus  NotificationStatus  @default(PENDING)

  subject     String?
  messageBody String

  sentAt DateTime?
  readAt DateTime?

  createdAt DateTime @default(now())

  @@index([recipientId])
  @@index([notificationStatus])
}

model Announcement {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  announcementTitle String
  announcementBody  String

  targetAudience String[]

  publishDate DateTime?
  expiryDate  DateTime?
  isPinned    Boolean   @default(false)

  createdBy String @db.Uuid
  creator   User   @relation("AnnouncementCreator", fields: [createdBy], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([schoolId])
  @@index([publishDate])
}

// ============================================
// SETTINGS & CONFIGURATION
// ============================================

model SchoolSetting {
  id String @id @default(uuid()) @db.Uuid

  schoolId String @db.Uuid
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  settingKey      String
  settingValue    String
  settingCategory String?
  description     String?

  updatedBy String?  @db.Uuid
  updatedAt DateTime @updatedAt

  @@unique([schoolId, settingKey])
  @@index([schoolId])
}

// ============================================
// AUDIT & LOGGING
// ============================================

model AuditLog {
  id String @id @default(uuid()) @db.Uuid

  actorId String? @db.Uuid
  actor   User?   @relation("AuditLogActor", fields: [actorId], references: [id], onDelete: SetNull)

  actionType     String
  targetEntity   String?
  targetEntityId String?

  // log tracking
  logLevel LogLevel @default(NORMAL)
  logType  LogType  @default(ACTIVITY)

  changeDetails Json?
  ipAddress     String?
  userAgent     String?

  createdAt DateTime @default(now())

  @@index([actorId])
  @@index([targetEntity, targetEntityId])
  @@index([createdAt])
}

// ============================================
// SUMMARY OF IMPROVEMENTS
// ============================================

/**
 * COMPLETE SCHEMA IMPROVEMENTS:
 * ✅ NAMING CONVENTIONS:
 * - All fields use clear, descriptive names
 * - Consistent patterns: "Name", "Number", "Date", "Id", "Url"
 * - Boolean fields start with "is", "has", "can", "allow"
 * - Dates end with "At" or "Date"
 * ✅ RELATIONSHIPS SIMPLIFIED:
 * - No complex multi-level hierarchies
 * - Clear one-to-many and many-to-many relationships
 * - Proper cascade and set null behaviors
 * - No circular dependencies
 * ✅ REMOVED COMPLEXITY:
 * - No soft deletes (use isActive flags)
 * - No complex competency system
 * - No multi-table gradebook
 * - Simplified curriculum (no 4-level hierarchy)
 * - Removed redundant tables
 * ✅ ADDED FUNCTIONALITY:
 * - Timetable management
 * - Report cards
 * - Fee and payment tracking
 * - Learning resources
 * - File uploads with categories
 * - Comprehensive notifications
 * - Audit logging
 * - School settings
 * ✅ KENYA-SPECIFIC FEATURES:
 * - M-PESA payment method
 * - County/SubCounty/Ward locations
 * - National codes (NEMIS, TSC, UPI)
 * - CBC grading system (GradeSymbol)
 * - Term-based academic structure
 * ✅ PERFORMANCE OPTIMIZATIONS:
 * - Strategic indexes on frequently queried fields
 * - Denormalized counts (currentStudentCount)
 * - Composite unique constraints
 * - Proper foreign key
 */
